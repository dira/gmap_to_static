<a href="javascript:(function(){
function is_object(elem){return(elem!=null)&&(typeof(elem)=='object');}function has_property(container,property){return typeof(container[property])!='undefined';}function is_marker(container){return has_property(container,'infoWindow')&&has_property(container,'latlng');}function explore(container,history){if(is_marker(container)&&history.toString().indexOf(',0')>-1){throw(history);}if(history.length<max_level){for(var property in container){if(!is_object(container[property]))continue;if(has_property(container[property],'parentNode'))continue;explore(container[property],history.concat([property]));}}}function get_color(marker){for(var property in marker){if(marker[property].indexOf&&marker[property].indexOf('.png')>-1){var color=marker[property];if(color.match(/^http/)){color=color.match('/[^/.]*.png')[0];color=color.substring(1,color.length-4);color=color.replace('-dot','');if(color=='pink')color='0xCE579A';if(color=='ltblue')color='0x67DDDD';return color;}}}return'';}function get_zoom(){var r=document.getElementById('map').offsetWidth/map.getBounds().toSpan().x;return 3+Math.round(Math.LOG2E*Math.log(0.175*r));}map=window.gApplication.getMap();max_level=3;markers=[];try{explore(map,[]);}catch(stack){container=map;for(var i=0;i<stack.length;i++){if(stack[i]=='0')break;container=container[stack[i]];}for(var m in container){var marker=container[m];for(var j=i+1;j<stack.length;j++){marker=marker[stack[j]];}markers.push(marker);}}size='350x450';url='http://maps.google.com/maps/api/staticmap?zoom='+get_zoom()+'&size='+size+'&center='+map.getCenter().toUrlValue()+'&maptype=roadmap&sensor=false';for(var i=0;i<markers.length;i++){var marker=markers[i];try{var latLng=marker['latlng'];url+='&markers=color:'+get_color(marker)+'|'+latLng.lat.toFixed(2)+','+latLng.lng.toFixed(2);}catch(err){}}window.open(url,'_blank');})()">make static map!</a>
