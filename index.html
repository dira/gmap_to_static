<a href='javascript:(function(){ function is_object(a){return(a!=null)&&(typeof(a)=="object")}function has_property(a,b){return typeof(a[b])!="undefined"}function is_marker(a){return has_property(a,"infoWindow")&&has_property(a,"latlng")}function is_path(a){return has_property(a,"getVertex")}function explore(b,d,a,e){if(d(b)&&e.toString().indexOf(",0")>-1){throw (e)}if(e.length<a){for(var c in b){if(!is_object(b[c])){continue}if(has_property(b[c],"parentNode")){continue}explore(b[c],d,a,e.concat([c]))}}}function search_for(h,c){results=[];try{explore(map,h,c,[])}catch(a){container=map;var b=0;var j=a.length;for(var f=j;f>=0;f--){if(a[f]=="0"){b=f;break}}for(var f=0;f<b;f++){container=container[a[f]]}for(var g in container){var d=container[g];for(var f=b+1;f<j;f++){d=d[a[f]]}results.push(d)}}return results}function get_color(a){for(var c in a){if(a[c].indexOf&&a[c].indexOf(".png")>-1){var b=a[c];if(b.match(/^http/)){b=b.match("/[^/.]*.png")[0];b=b.substring(1,b.length-4);b=b.replace("-dot","");if(b=="pink"){b="0xCE579A"}if(b=="ltblue"){b="0x67DDDD"}return b}}}return""}function between(b,c,a){return a.lat<=b.lat()&&a.lng>=b.lng()&&a.lat>=c.lat()&&a.lng<=c.lng()}function get_zoom(){var a=map_element.offsetWidth/map.getBounds().toSpan().x;return 3+Math.round(Math.LOG2E*Math.log(0.175*a))}function get_url(){var c=search_for(is_marker,3);var i=search_for(is_path,4);var j=[Math.min(640,Math.round(map_element.offsetWidth/10)*10),Math.min(640,Math.round(map_element.offsetHeight/10)*10)];try{var b=prompt("Size",j.join("x")).split("x");if(Number(b[0])&&Number(b[1])){j=[Number(b[0]),Number(b[1])]}}catch(d){}var h=get_zoom();var a="http://maps.google.com/maps/api/staticmap?zoom="+h+"&size="+j.join("x")+"&center="+map.getCenter().toUrlValue()+"&maptype=roadmap&sensor=false";var f=map.fromLatLngToDivPixel(map.getCenter());f.x-=Math.round(j[0]/2);f.y-=Math.round(j[1]/2);f=map.fromDivPixelToLatLng(f);var g=map.fromLatLngToDivPixel(map.getCenter());g.x+=Math.round(j[0]/2);g.y+=Math.round(j[1]/2);g=map.fromDivPixelToLatLng(g);a+="&"+c.map(function(e){var k=e.latlng;if(!between(f,g,k)){return null}return"markers=color:"+get_color(e)+"|"+k.lat.toFixed(2)+","+k.lng.toFixed(2)}).filter(function(k){return k!=null}).join("&");a+="&"+i.map(function(p){var o=[];var q=p.getVertexCount();var e=[];for(var m=0;m<q;m++){var l=p.getVertex(m);if(between(f,g,{lat:l.lat(),lng:l.lng()})){e.push(m,m+1,m-1)}}for(var m=0;m<q;m++){if(e.indexOf(m)==-1){continue}var l=p.getVertex(m);o.push(l.lat().toFixed(2)+","+l.lng().toFixed(2))}if(o.length<2){return null}var k=p.color=="#0000ff"?"":("color:"+p.color.replace("#","0x")+"|");return"path="+k+o.join("|")}).filter(function(k){return k!=null}).join("&");return a}map=window.gApplication.getMap();map_element=document.getElementById("map");window.open(get_url(),"_blank"); })()'>make static map!</a>
