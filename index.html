<a href='javascript:(function(){ function is_object(a){return(a!=null)&&(typeof(a)=="object")}function has_property(a,b){return typeof(a[b])!="undefined"}function is_marker(a){return has_property(a,"infoWindow")&&has_property(a,"latlng")}function is_path(a){return has_property(a,"getVertex")&&has_property(a,"name")}function is_shape(a){return has_property(a,"getVertex")&&!has_property(a,"name")}function explore(b,d,a,e){if(d(b)&&e.toString().indexOf(",0")>-1){throw (e)}if(e.length<a){for(var c in b){if(!is_object(b[c])){continue}if(has_property(b[c],"parentNode")){continue}explore(b[c],d,a,e.concat([c]))}}}function search_for(j,l){var d=[];try{explore(map,j,l,[])}catch(h){var a=map;var k=0;var b=h.length;for(var f=b;f>=0;f--){if(h[f]=="0"){k=f;break}}for(var f=0;f<k;f++){a=a[h[f]]}for(var g in a){var c=a[g];for(var f=k+1;f<b;f++){c=c[h[f]]}if(c){d.push(c)}}}return d}function get_color(a){for(var c in a){if(a[c].indexOf&&a[c].indexOf(".png")>-1){var b=a[c];if(b.match(/^http/)){b=b.match("/[^/.]*.png")[0];b=b.substring(1,b.length-4);b=b.replace("-dot","");if(b=="pink"){b="0xCE579A"}if(b=="ltblue"){b="0x67DDDD"}return b}}}return""}function between(b,c,a){return a.lat<=b.lat()&&a.lng>=b.lng()&&a.lat>=c.lat()&&a.lng<=c.lng()}function get_zoom(){var a=map_element.offsetWidth/map.getBounds().toSpan().x;return 3+Math.round(Math.LOG2E*Math.log(0.175*a))}function get_url(){var d=search_for(is_marker,3);var j=search_for(is_path,4);var b=search_for(is_shape,4);j=j.concat(b);var k=[Math.min(640,Math.round(map_element.offsetWidth/10)*10),Math.min(640,Math.round(map_element.offsetHeight/10)*10)];try{var c=prompt("Size",k.join("x")).split("x");if(Number(c[0])&&Number(c[1])){k=[Number(c[0]),Number(c[1])]}}catch(f){}var i=get_zoom();var a="http://maps.google.com/maps/api/staticmap?zoom="+i+"&size="+k.join("x")+"&center="+map.getCenter().toUrlValue()+"&maptype=roadmap&sensor=false";var g=map.fromLatLngToDivPixel(map.getCenter());g.x-=Math.round(k[0]/2);g.y-=Math.round(k[1]/2);g=map.fromDivPixelToLatLng(g);var h=map.fromLatLngToDivPixel(map.getCenter());h.x+=Math.round(k[0]/2);h.y+=Math.round(k[1]/2);h=map.fromDivPixelToLatLng(h);a+="&"+d.map(function(e){var l=e.latlng;if(!between(g,h,l)){return null}return"markers=color:"+get_color(e)+"|"+l.lat.toFixed(precision)+","+l.lng.toFixed(precision)}).filter(function(l){return l!=null}).join("&");a+="&"+j.map(function(q){var p=[];var r=q.getVertexCount();var e=[];for(var o=0;o<r;o++){var m=q.getVertex(o);if(between(g,h,{lat:m.lat(),lng:m.lng()})){e.push(o,o+1,o-1)}}for(var o=0;o<r;o++){if(e.indexOf(o)==-1){continue}var m=q.getVertex(o);p.push(m.lat().toFixed(precision)+","+m.lng().toFixed(precision))}if(p.length<2){return null}var l=q.color=="#0000ff"?"":("color:"+q.color.replace("#","0x")+"|");return"path="+l+p.join("|")}).filter(function(l){return l!=null}).join("&");return a}map=window.gApplication.getMap();map_element=document.getElementById("map");precision=3;window.open(get_url(),"_blank"); })()'>make static map!</a>
